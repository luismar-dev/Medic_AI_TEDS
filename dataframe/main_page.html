<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IA Medical Analysis</title>
    <link rel="stylesheet" href="main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="header-container">
      <div class="header-logo">
        <div class="logo">
          <img
            class="logo-image"
            src="https://raw.githubusercontent.com/luismar-dev/Medic_AI_TEDS/33f7acfffc898e8fcd58ca74b699b1d5f4a64c28/project/logo_Medic_AI.png"
            alt="Ícono de salud"
          />
          <img
            class="logo-title"
            src="https://raw.githubusercontent.com/luismar-dev/Medic_AI_TEDS/33f7acfffc898e8fcd58ca74b699b1d5f4a64c28/project/nombre_Medic_AI.png"
            alt="Medic-AI"
          />
        </div>
      </div>
      <div class="header">
        <button id="btnDiagnosticos">Tabla de diagnosticos</button>
        <button id="btnResultados">Tabla de resultados</button>
      </div>
    </div>

    <div class="table-container" id="tablaContainer">
      <table class="data-table">
        <thead>
          <tr id="tableHeader"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <div class="modal" id="modalSintomas">
      <div class="modal-content">
        <div class="modal-header">
          <button class="modal-close" onclick="cerrarModal()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="30"
              height="30"
              fill="currentColor"
              class="bi bi-x"
              viewBox="0 0 16 16"
            >
              <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"
              />
            </svg>
          </button>
        </div>
        <div class="modal-body" id="modalBody"></div>
      </div>
    </div>

    <!-- Cargamos data.js primero -->
    <script src="data.js"></script>

    <script>
      // Guardamos 'tableData' (de data.js) en una variable única.
      const diagnosticosTableData = [...tableData];
    </script>

    <!-- Cargamos resp.js después -->
    <script src="resp.js"></script>

    <script>
      // Ahora capturamos los datos de resp.js en una variable NUEVA
      // Asumiendo que resp.js usa la variable 'respTableData'
      const resultadosTableData = [...respTableData];
    </script>

    <script>
      // Variable para rastrear qué tabla está activa
      let currentTableData = null; // 'diagnosticos' o 'resultados'

      function mostrarSintomas(sintomas) {
        const modal = document.getElementById("modalSintomas");
        const modalBody = document.getElementById("modalBody");
        modalBody.textContent = sintomas || "No hay síntomas registrados";
        modal.classList.add("active");
      }

      function cerrarModal() {
        const modal = document.getElementById("modalSintomas");
        modal.classList.remove("active");
      }

      document
        .getElementById("modalSintomas")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            cerrarModal();
          }
        });

      function cargarTabla(data) {
        if (!data || data.length === 0) return;

        const header = document.getElementById("tableHeader");
        const body = document.getElementById("tableBody");
        const columnas = Object.keys(data[0]);

        header.innerHTML = "";
        body.innerHTML = "";

        header.innerHTML = columnas.map((col) => `<th>${col}</th>`).join("");

        body.innerHTML = data
          .map((row, index) => {
            const celdas = columnas
              .map((col) => {
                if (col === "Sintomas") {
                  return `<td style="text-align: center; cursor: pointer;" onclick="mostrarSintomas(\`${
                    row[col]?.replace(/`/g, "\\`") || ""
                  }\`)">
      <span style="display: inline-flex; align-items: center; gap: 8px; color: #000000; white-space: nowrap;">
        Ver Síntomas<span style="font-size: 12px;">▼</span>
      </span>
    </td>`;
                }
                return `<td>${row[col] !== null ? row[col] : "—"}</td>`;
              })
              .join("");
            return `<tr>${celdas}</tr>`;
          })
          .join("");
      }

      // Función para actualizar el estado activo de los botones
      function actualizarBotonActivo(botonActivo) {
        // Remover la clase active de todos los botones
        document.querySelectorAll(".header button").forEach((btn) => {
          btn.classList.remove("active");
        });

        // Agregar la clase active al botón seleccionado
        if (botonActivo) {
          botonActivo.classList.add("active");
        }
      }

      // Lógica para el botón de Diagnósticos
      document
        .getElementById("btnDiagnosticos")
        .addEventListener("click", function () {
          const tabla = document.getElementById("tablaContainer");

          if (
            tabla.classList.contains("active") &&
            currentTableData === "diagnosticos"
          ) {
            tabla.classList.remove("active");
            currentTableData = null;
            actualizarBotonActivo(null);
          } else {
            // Usa la variable 'diagnosticosTableData'
            cargarTabla(diagnosticosTableData);
            tabla.classList.add("active");
            currentTableData = "diagnosticos";
            actualizarBotonActivo(this);
          }
        });

      // Lógica para el botón de Resultados
      document
        .getElementById("btnResultados")
        .addEventListener("click", function () {
          const tabla = document.getElementById("tablaContainer");

          if (
            tabla.classList.contains("active") &&
            currentTableData === "resultados"
          ) {
            tabla.classList.remove("active");
            currentTableData = null;
            actualizarBotonActivo(null);
          } else {
            // Usa la variable 'resultadosTableData' (que ahora viene de resp.js)
            cargarTabla(resultadosTableData);
            tabla.classList.add("active");
            currentTableData = "resultados";
            actualizarBotonActivo(this);
          }
        });

      // Cerrar modal con tecla ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          cerrarModal();
        }
      });
    </script>
  </body>
</html>
